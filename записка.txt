«THE EMPRESS OF PENTACLES»

### 1. Введение
«The Empress of Pentacles» – это песочница в жанре платформера с элементами физической симуляции и магического боя. Игрок управляет ведьмой, исследующей процедурно генерируемый мир, состоящий из взаимодействующих веществ. Основной геймплей сосредоточен в режиме IntegratedWorldView, который объединяет физику мира, платформенное перемещение, магическую систему и боевые механики.

### 2. Физический мир и вещества
Мир представлен сеткой ячеек, каждая из которых может содержать одно из множества веществ: камень, дерево, вода, песок, лава, огонь, пар, кислота, порох и другие. Каждое вещество обладает уникальным поведением:
- **Твёрдые вещества** (камень, дерево, железо, земля, трава) остаются на месте и могут быть уничтожены при определённых условиях (например, дерево горит).
- **Сыпучие вещества** (песок, снег, порох) падают вниз и могут скатываться по диагонали.
- **Жидкости** (вода, лава, бензин, кислота) растекаются, стекают вниз и взаимодействуют с окружением (например, кислота растворяет некоторые материалы).
- **Газы** (дым, пар, огонь, плазма) поднимаются вверх, рассеиваются и могут воспламенять окружение.
- **Динамические вещества** (огонь, плазма, взрыв) наносят урон соседним ячейкам и могут превращаться в другие вещества.

Физика обновляется с фиксированным интервалом, что обеспечивает стабильную симуляцию даже при большом количестве объектов.

### 3. Платформенное перемещение и управление
Игрок управляет ведьмой, которая может:
- **Перемещаться** влево и вправо с регулируемой скоростью.
- **Прыгать** с переменной высотой; прыжковая физика включает ускорение падения и проверку столкновений с платформами.
- **Падать** с высоты; при падении с критической высоты игрок получает урон и возвращается на последнюю безопасную позицию.
- **Взаимодействовать с окружением**: проверяются столкновения с твёрдыми блоками снизу, сверху и с боков, что позволяет ходить по платформам и не проходить сквозь стены.

Камера следует за игроком, центрируя его на экране. Мир отрисовывается с учётом позиции камеры, что обеспечивает плавный скроллинг.

### 4. Магическая система и заклинания
Игрок использует магический посох для применения заклинаний. Система включает:
- **Элементальный круг**: интерфейс для выбора стихий (огонь, вода, земля, воздух). Игрок может назначать стихии на направления (вверх, вниз, влево, вправо) и переключать их в режиме редактирования.
- **Комбо заклинаний**: последовательное нажатие направлений создаёт комбинацию, которая преобразуется в конкретное заклинание. Длина комбо определяет силу заклинания.
- **Типы заклинаний**:
  - Линейные снаряды (искра огня, брызги воды) летят прямо с постоянной скоростью.
  - Параболические снаряды (огненный шар, водяной шар) летят по дуге с учётом гравитации.
  - Зонные заклинания (солнечный удар, земляные шипы) наносят урон по области с задержкой и анимацией.
- **Прогресс перезарядки**: у каждого заклинания есть время перезарядки, отображаемое в виде прогресс бара.

### 5. Боевые механики и враги
В мире генерируются враги, которые располагаются на платформах:
- **Призраки**: летающие враги, которые преследуют игрока и наносят урон при контакте.
- **Бочки**: статичные враги, которые при уничтожении взрываются и создают вокруг себя вещества (воду, лаву, кислоту и т.д.).

Игрок может атаковать врагов заклинаниями, нанося урон. При убийстве врагов игрок получает очки убийств; при достижении определённого количества убийств уровень повышается, и мир перезагружается с новой процедурной генерацией.

### 6. Здоровье и опасности
У игрока есть здоровье, которое отображается в виде полоски HP. Здоровье можно потерять:
- При контакте с опасными веществами (лава, кислота, огонь и т.д.).
- При падении с большой высоты.
- При атаке врагов.

При достижении нуля здоровья игрок умирает, и активируется экран смерти.

### 7. Интерфейс пользователя
Интерфейс включает:
- **Полоски здоровья и маны** с градиентной заливкой.
- **Прицел** в виде перекрестия, следующий за курсором мыши.
- **Панель быстрого доступа** для выбранных заклинаний с отображением иконок и прогресса перезарядки.
- **Элементальный круг** для управления стихиями.
- **Отображение статистики**: FPS, количество веществ на экране, счётчик убийств, текущий уровень.
- **Гримуар** (книга заклинаний), который можно открыть для просмотра информации о заклинаниях и игровом мире.

### 8. Процедурная генерация мира
Уровни генерируются процедурно с помощью функций в модуле levels:
- Создаются платформы из различных веществ (земля, трава, камень).
- Формируются пещеры и туннели с помощью алгоритма «муравья».
- Враги размещаются на подходящих платформах с учётом минимального расстояния между ними.
- При переходе на новый уровень мир полностью пересоздаётся, обеспечивая новое расположение платформ и врагов.

### 9. Аудиовизуальное оформление
- **Графика**: спрайтовая анимация персонажа (ходьба, прыжок), анимированные заклинания, разноцветные вещества с вариациями оттенков.
- **Звук**: фоновая музыка, звуковые эффекты для заклинаний и взаимодействий.
- **Анимации**: плавные переходы камеры, анимация здоровья и маны, эффекты частиц для некоторых заклинаний.

### 10. Заключение
Игра представляет собой комплексную игровую систему, сочетающую физическую песочницу, платформер, магический бой и процедурную генерацию. Механики взаимодействуют друг с другом, создавая динамичный и непредсказуемый игровой процесс, где игрок может экспериментировать с веществами, использовать разнообразные заклинания и исследовать каждый раз новый мир.